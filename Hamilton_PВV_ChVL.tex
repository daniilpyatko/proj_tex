\documentclass{article}

\usepackage[T2A]{fontenc}
\usepackage[cp1251]{inputenc}
\usepackage[english,russian]{babel}
\usepackage[tbtags]{amsmath}
\usepackage{amsfonts,amssymb}

\usepackage{mathrsfs}
\usepackage{tikz}
\usepackage[paper]{mz2ewin}
\usepackage{placeins}

\usepackage{graphicx}

% \DeclareMathOperator{\di}{d\!}
% \newcommand*\Eval[3]{\left.#1\right\rvert_{#2}^{#3}}

% \DeclareMathOperator{\didi}{d\!}
% \newcommand*\Evalat[2]{\left.#1\right\rvert_{#2}}

% \DeclareMathOperator{\dididi}{d\!}
% \newcommand*\littleo[1]{\overline o\left(#1\right)}

% \DeclareMathOperator{\didididi}{d\!}
% \newcommand*\bigo[1]{O\left(#1\right)}

\newcommand{\RN}[1]{
\textup{\uppercase\expandafter{\romannumeral#1}}
}

\newcommand{\squad}{
    \hspace{0.5em}
} 



\hoffset -10mm
\voffset -7mm


\let\rom=\textup


\def\thesubsection{\arabic{section}.\arabic{subsection}}
\numberwithin{equation}{section}

%\numberwithin{equation}{subsection}


\theoremstyle{plain}

\newtheorem{theorem}{Теорема}
\newtheorem{proposition}{Предложение}
\newtheorem{lemma}{Лемма}
\newtheorem{corollary}{Следствие}
\newtheorem{notation}{Обозначения}
\newtheorem{definition}{Определение}
\newtheorem{note}{Замечание}

\theoremstyle{definition}
\newtheorem{proof}{Доказательство}\def\theproof{}
\newtheorem{remark}{Замечание}

% \allowdisplaybreaks

% \newcommand{\keywordss}[1]{
% \vspace*{3mm}
% \indent{\bf Ключевые слова:} {#1}
% }



\overfullrule5pt
%\mag1096
\mag1300
\begin{document}

\udk{519.1}

\date{\today }

\author{Д.\,В.~Пятько, В.\,Л. Чернышев}
\address{Национальный исследовательский университет ``Высшая школа экономики'' (НИУ ВШЭ) , г.~Москва}
\email{vchernyshev@hse.ru}

\title{Асимптотика количества конечных положений случайного блуждания на ориентированном гамильтоновом метрическом графе}


\markboth{Д.\,В.~Пятько, В.\,Л. Чернышев}{}


\maketitle

\begin{fulltext}
\begin{abstract}
Получена асимптотика числа конечных положений случайного блуждания на ориентированном гамильтоновом метрическом графе.

Библиография: 7 названий.

\end{abstract}

\begin{keywords}
    считающая функция, ориентированный граф, динамическая система, многочлен Барнса---Бернулли
\end{keywords}

% \end{keywordss}

\footnotetext{Работа была выполнена при поддержке гранта РФФИ 20-07-01103 а.}


\section{Введение и постановка задачи}
\label{sec1}

%Стационарные состояния в квантовой задаче
%о движении электрона, удерживаемого на
%гладкой поверхности~$S$ в магнитном
%поле~$\mathbf H$, описываются уравнением
%Шрёдингера
%\begin{equation}
%\widehat H\Psi=E\Psi.
%\label{1.1}
%\end{equation}
% Начнем
%с классического поведения системы.
%
%\begin{definition} Будем называть ...
%\end{definition}
%
%\begin{proposition} Пусть выполняются следующие неравенства...
%\end{proposition}
%
%\begin{lemma}
%При условии, что функция $\lambda(z)$ ...
%\end{lemma}
%
%
%\section{Классическая система. Топология разбиения фазового пространства
%на торы Лиувилля}
%\label{subsec2}
%
%Проекция~$p_\phi$ момента движения на
%ось~$Z$ вдоль поля сохраняется, что
%следует из симметрии вращения вокруг
%оси~$Z$~\cite{4}.
%
%\begin{theorem} \label{theo1}
%Для собственных чисел оператора $\mathscr{H}$ справедливы оценки ...
%\end{theorem}
%\begin{proof}
%Как показано в \cite{3} ...
%\end{proof}
%
%
%\begin{corollary} Необходимыми и достаточными условиями сходимости ряда ...
%\end{corollary}
%
%\begin{remark} Отметим, что доказательство теоремы \ref{theo1}
%может быть распространено на случай ...
%\end{remark}


%\begin{figure}[ht]
%\centering
%\includegraphics{1nek80-1}
%\caption{Бифуркационная диаграмма для сферы.}
%\label{fig1}
%\end{figure}


Рассмотрим ориентированный метрический граф (одномерный клеточный комплекс, см. книгу \cite{KB} и ссылки в ней). Каждое ребро его является гладкой регулярной кривой и имеет длину, а также разрешенное направление движения. Мы будем рассматривать ситуацию общего положения и предполагать, что все длины ребер линейно независимы над полем рациональных чисел. Также зафиксируем вершину, которую будем называть стартовой. Из неё в начальный момент времени выходит случайное блуждание (см. \cite{Lovasz}, \cite{RW}). В каждой вершине с ненулевой вероятностью мы можем выбрать исходящее ребро для дальнейшего движения. Развороты на ребрах запрещены. Для анализа числа возможных конечных положений такого блуждания полезно предположить, что реализуются все возможности. Таким образом мы приходим к следующей динамической системе. В нулевой момент времени из стартовой вершины вдоль всех ребер, которые из нее выходят, начинают двигаться точки с единичной скоростью. Как только какая-то из точек оказывается в вершине, на каждом инцидентном вершине исходящем ребре появляется новая точка, которая начинает двигаться в сторону конца ребра, а старая исчезает. Если в одну вершину одновременно приходит сразу несколько точек, то все эти точки пропадают, а появляются новые точки так, как это было описано для одной точки. Наша основаня задача: исследовать $N(T)$ --- количество движущихся точек в момент времени $T$ на различных конечных компактных графах.

Данная динамическая система уже рассмотривалась для случая неориентированных графов (см. \cite{Chernyshev2017}, \cite{RCD}). Для числа движущихся точек было получено полиномиальное приближение, то есть было приведено описание многочлена степени $E - 1$, где $E$ --- число ребер графа, который аппроксимирует $N(T)$ с точностью до некоторой степени логарифма. Рассмотрение подобных динамических систем было мотивировано задачами о распространении узких волновых пакетов на метрических графах и гибридных мноогообразиях (см. \cite{ChSh} и ссылки там). Совсем  недавно для некоторого класса ориентированных графов (однонаправленные шпернеровы графы) в  статье \cite{2021} был получен старший член асимптотики.

В этой статье мы будем рассматривать произвольные ориентированные гамильтоновы графы.



\subsection{Структура текста и рассматриваемые графы}


\begin{definition}
  Через $N(T)$ будем обозначать количество движущихся точек в момент времени $T$, а через $N_{x}(T)$ --- количество моментов времени $\leq T$, таких, что в вершину номер $x$ заходили точки.
\end{definition}

Наша основная задача --- найти асимптотику $N(T)$ для графов, которые будут описаны далее. Рассмотрим ориентированный гамильтонов граф $G = (V, E)$.
$V$ --- множество вершин графа. Дополнительно положим $n = |V|$.
$E$ --- множество ребер графа, допускаются кратные ребра, но петли (ребра из вершины в саму себя) не разрешаются.

Будем рассматривать графы, в которых есть цикл $(1, 2, \ldots, n)$, если этого цикла нет, то в силу гамильтоновости можно так перенумеровать вершины $\{2, \ldots, n\}$, чтобы такой цикл был. Заметим, что для графа с перенумерованными вершинами $N(T)$ будет таким же, как и для исходного графа в любой момент времени.

Временем прохода ребра будем считать $t(e), \squad e \in E$, также можно считать, что $t(e)$ --- длина ребра, потому что точки движутся с единичной скоростью.
Считаем, что случайное блуждание начинается из вершины с номером $1$ и множество времен ребер $\{t(e), e \in E\}$ линейно независимо над $\mathbb{Q}$.
Будем считать, что вершины и ребра пронумерованы: $(v_{1}, \ldots, v_{n})$, $(e_{1}, \ldots, e_{|E|})$.


Напомним, что первое число Бетти метрического графа (то есть одномерного клеточного комплекса) можно найти по формуле: $\beta = |E| - |V| + 1$.
Будем рассматривать графы с $\beta \geq 2$. При $\beta = 1$ получаем граф-цикл, для которого $N(T) = 1$ для любого времени $T > 0$.



%\begin{figure}
%\begin{center}
%\includegraphics[scale=0.2]{im-01.jpg}
%\end{center}
%\caption{Пример гамильтонова графа с выделенной стартовой вершиной}
%\label{fig:graph}
%\end{figure}

%\begin{figure}[!htb]
%\begin{center}
%\tikzstyle{circ node}=[circle,draw=black]
%\tikzstyle{arrow style}=[->,-{Latex[width=2mm]}]
%\begin{tikzpicture}[minimum size=1cm, scale=3]
%    \node[circ node,draw=green] (1) at (0 * 90:1cm) {$1$};
%    \node[circ node] (2) at (1 * 90:1cm) {$2$};
%    \node[circ node] (3) at (2 * 90:1cm) {$3$};
%    \node[circ node] (4) at (3 * 90:1cm) {$4$};
%
%    \draw[arrow style] (1) edge node {} (2);
%    \draw[arrow style] (2) edge node {} (3);
%    \draw[arrow style] (3) edge node {} (4);
%    \draw[arrow style] (4) edge node {} (1);
%
%    \draw[arrow style] (4) edge[bend right=30] node {} (1);
%    \draw[arrow style] (2) edge[bend left=30] node {} (1);
%    \draw[arrow style] (4) edge[bend left=30] node {} (3);
%    \draw[arrow style] (1) edge node {} (3);
%\end{tikzpicture}
%\caption{Пример гамильтонова графа с выделенной стартовой вершиной}
%\label{fig:graph}
%\end{center}
%\end{figure}

Несколько слов о дальнейшем устройстве работы. В разделе $3.1$ мы показываем, что достаточно представить $N_{1}(T)$ в виде
\begin{gather*}
N_{1}(T) = aT^{\beta} + bT^{\beta - 1} + O(T^{\beta - 2}),
\end{gather*}
где $\beta$ --- первое число Бетти нашего комплекса, чтобы получить асимптотику $N(T)$. Разделы $2.1, 2.2, 2.3, 2.4$ посвящены нахождению нужного представления для произвольных графов, которые уже были описаны в этом разделе.
Раздел $2.5$ содержит утверждения, используя которые, можно упростить вычисление коэффициента. В разделе $3.2$ мы, используя результаты из $3.1$ и $2.1, 2.2, 2.3, 2.4, 2.5$, получаем итоговую формулу для $N(T)$.

\section{Классификация путей в стартовую вершину}

\subsection{Алгоритм}

Введем несколько обозначений.
Для каждой вершины $i$ есть ребро в следующую вершину: для $i \in \{1, \ldots, n - 1\}$ это $i + 1$, а для $n$ это $1$.
Будем называть такие ребра внутренними (если таких ребер несколько для вершины $i$, то берем любое, таких ребер может быть несколько, если есть кратные ребра). Цикл из внутренних ребер будет называться внутренним циклом. Остальные ребра будут называться внешними. Цикл с внешним ребром мы будем называть внешним циклом. Для каждой вершины рассмотрим все выходящие из нее ребра. Зафиксируем на них порядок так, чтобы внутреннее ребро было последним.\\

%Рассмотрим пример.
%
%\begin{figure}[!htb]
%\begin{center}
%\includegraphics[scale=0.1]{im-02.jpg}
%\end{center}
%\caption{Внешние и внутренние ребра, порядок на ребрах. Красным выделены внутренние ребра, черным выделены внешние ребра. Справа: возможный порядок на ребрах, последнее ребро из любой вершины --- внутреннее ребро.}
%\end{figure}

%\begin{figure}[!htb]
%\begin{center}
%\tikzstyle{circ node}=[circle,draw=black]
%\tikzstyle{arrow style}=[->,-{Latex[width=2mm]}]
%\begin{tikzpicture}[minimum size=1cm, scale=3]
%    \node[circ node,draw=green] (1) at (0 * 90:1cm) {$1$};
%    \node[circ node] (2) at (1 * 90:1cm) {$2$};
%    \node[circ node] (3) at (2 * 90:1cm) {$3$};
%    \node[circ node] (4) at (3 * 90:1cm) {$4$};
%
%    \draw[arrow style] (1) edge[draw=red] node {} (2);
%    \draw[arrow style] (2) edge[draw=red] node {} (3);
%    \draw[arrow style] (3) edge[draw=red] node {} (4);
%    \draw[arrow style] (4) edge[draw=red] node {} (1);
%
%    \draw[arrow style] (4) edge[bend right=30] node {} (1);
%    \draw[arrow style] (2) edge[bend left=30] node {} (1);
%    \draw[arrow style] (4) edge[bend left=30] node {} (3);
%    \draw[arrow style] (1) edge node {} (3);
%    \begin{scope}[yshift=-1.5cm]
%        \node[text width=6cm] at (0, 0) {{\color{red} Красным} выделены внутренние ребра, черным выделены внешние ребра};
%    \end{scope}
%    \begin{scope}[xshift=3cm]
%        \node[circ node,draw=green] (1) at (0 * 90:1cm) {$1$};
%        \node[circ node] (2) at (1 * 90:1cm) {$2$};
%        \node[circ node] (3) at (2 * 90:1cm) {$3$};
%        \node[circ node] (4) at (3 * 90:1cm) {$4$};
%
%        \draw[arrow style] (1) edge node[left] {{\color{red} 2}} (2);
%        \draw[arrow style] (2) edge node[right] {{\color{blue} 2}} (3);
%        \draw[arrow style] (3) edge node[right] {{\color{magenta} 1}} (4);
%        \draw[arrow style] (4) edge node[left] {{\color{orange} 3}} (1);
%
%        \draw[arrow style] (4) edge[bend right=30] node[right] {{\color{orange} 1}} (1);
%        \draw[arrow style] (2) edge[bend left=30] node[right] {{\color{blue}1}} (1);
%        \draw[arrow style] (4) edge[bend left=30] node[left] {{\color{orange} 2}} (3);
%        \draw[arrow style] (1) edge node[auto] {{\color{red} 1}} (3);
%        \begin{scope}[yshift=-1.5cm]
%            \node[text width=6cm] at (0, 0) {Возможный порядок на ребрах, последнее ребро из любой вершины --- внутреннее ребро};
%        \end{scope}
%    \end{scope}
%\end{tikzpicture}
%\caption{Внешние и внутренние ребра, порядок на ребрах. Красным выделены внутренние ребра, черным выделены внешние ребра. Справа: возможный порядок на ребрах, последнее ребро из любой вершины --- внутреннее ребро.}
%\end{center}
%\end{figure}

% \FloatBarrier

%Красным выделены внутренние ребра, черным внешние, все внутренние ребра образуют гамильтонов цикл.

\begin{definition} $ $
    % \begin{enumerate}

        Пусть $\mathcal{H}$ --- множество всех таких графов $H$, которые получены из $G$ присвоением неотрицательных целых чисел ребрам так, что для любой вершины сумма чисел на входящих ребрах равна сумме чисел на выходящих.
        % \item $c = a + b$ для $a \in \mathcal{H}, \squad b \in \mathcal{H}$ будет такой граф $c \in \mathcal{H}$, что у него на каждом ребре написана сумма чисел соответствующих ребер $a$ и $b$.
        % \item $c = \alpha b$ для $b \in \mathcal{H}, \squad \alpha \in \mathbb{N}$ будет такой граф $c \in \mathcal{H}$, что у него на каждом ребре написано произведение числа для соответствующего ребра в $b$ и $\alpha$.
    % \end{enumerate}
\end{definition}


В контексте графа $a \in \mathcal{H}$ или его подграфа можно говорить о том, что граф или его подграф является нулевым или ненулевым. Первое означает, что все присвоенные числа на ребрах равны $0$, а второе, что есть ребро, число на котором не $0$.
В частности, можно говорить о том, что какое-то ребро является нулевым или ненулевым.

Сложение двух графов $a \in \mathcal{H}$ и $b \in \mathcal{H}$ определяется естественным образом: в результирующем графе на каждом ребре написана сумма чисел соответствующих ребер графов $a$ и $b$.
Умножение $a \in \mathcal{H}$ на целую константу $\alpha$ определяется как умножение присвоенного числа каждого ребра в $a$ на $\alpha$.


Число, соотвествующее ребру, может означать сколько раз по нему прошли. Равенство суммы входящих сумме выходящих означает, что в каждую вершину зашли и вышли одинаковое число раз. Множество $\mathcal{H}$ дальше понадобится для того, чтобы описать алгоритм на графах из этого множества.

Предъявим алгоритм, который разбивает $H \in \mathcal{H}$ на циклы определенного вида.
Пусть $H' = H$. В $H'$ будут меняться числа на ребрах и отметки во время работы алгоритма.
\begin{center}
    \textit{Алгоритм разбиения на циклы}
\end{center}

\begin{center}
\fbox{\begin{minipage}{30em}
\texttt{Шаг 1. Начиная из вершины $1$, каждый раз выбираем первое неотмеченное ребро. Когда приходим в вершину, в которой уже были, полагаем $c$ -- образованный цикл.} \\

\texttt{Шаг 2. Пока в графе $H'$ все ребра вдоль цикла $c$ имеют числа больше $0$, вычитаем $1$ вдоль них и берем цикл $c$ в ответ.} \\

\texttt{Шаг 3. Если цикл $c$ -- внутренний и нулевой, то останавливаемся.} \\
\texttt{       Иначе отмечаем первое нулевое внешнее ребро в цикле $c$. Возвращаемся к шагу $1$.} \\

\end{minipage}}
\end{center}

Граф $H'$ меняется в ходе \texttt{шага 2}, когда из чисел на ребрах вычитаются числа и \texttt{шага 3}, когда появляются отметки на ребрах.

В ходе \texttt{шага 1} и \texttt{шага 2} цикл $c$ рассматривается как подграф $G$ (без присвоенных чисел на ребрах).
В ходе \texttt{шага 3} цикл $c$ рассматривается как подграф $H'$ (с присвоенными числами на ребрах).


\begin{figure}[!htb]
\begin{center}
\includegraphics[scale=0.2]{im-03.jpg}
\end{center}
\caption{Пример работы алгоритма.}
\end{figure}

\FloatBarrier



%\begin{figure}[!htb]
%\begin{center}
%\begin{tikzpicture}[minimum size=0.7cm, scale=0.8, baseline=(current bounding box.center)]
%    \node[shape=circle,draw=black] (0) at (0, 0) {$2$};
%    \node[shape=circle,draw=green] (3) at (0, 3) {$1$};
%    \node[shape=circle,draw=black] (2) at (0, -3) {$3$};
%
%    \draw [, -{Latex[width=2mm]}] (3) edge [bend left] node[right]  {$3$} (0);
%    \path [blue,-{Latex[width=2mm]}] (3) edge [bend right] node[right] {$2$} (0);
%    \path [, -{Latex[width=2mm]}] (0) edge [bend left] node[right] {$1$} (2);
%    \path [blue,-{Latex[width=2mm]}] (0) edge [bend right] node[right] {$4$} (2);
%    \path [blue, -{Latex[width=2mm]}] (2) edge [bend left=50] node[right] {$5$} (3);
%\end{tikzpicture} \squad $\longrightarrow$ \squad
%\begin{tikzpicture}[minimum size=0.7cm, scale=0.8, baseline=(current bounding box.center)]
%    \node[shape=circle,draw=black] (0) at (0, 0) {$2$};
%    \node[shape=circle,draw=green] (3) at (0, 3) {$1$};
%    \node[shape=circle,draw=black] (2) at (0, -3) {$3$};
%
%    \draw [blue, -{Latex[width=2mm]}] (3) edge [bend left] node[right]  {$3$} (0);
%    \path [-{Latex[width=2mm]}] (3) edge [bend right] node[right] {$0$} (0);
%    \path [-{Latex[width=2mm]}] (0) edge [bend left] node[right] {$1$} (2);
%    \path [blue, -{Latex[width=2mm]}] (0) edge [bend right] node[right] {$2$} (2);
%    \path [blue, -{Latex[width=2mm]}] (2) edge [bend left=50] node[right] {$3$} (3);
%\end{tikzpicture}
%\squad $\longrightarrow$ \squad
%\begin{tikzpicture}[minimum size=0.7cm, scale=0.8, baseline=(current bounding box.center)]
%    \node[shape=circle,draw=black] (0) at (0, 0) {$2$};
%    \node[shape=circle,draw=green] (3) at (0, 3) {$1$};
%    \node[shape=circle,draw=black] (2) at (0, -3) {$3$};
%
%    \draw [blue, -{Latex[width=2mm]}] (3) edge [bend left] node[right]  {$1$} (0);
%    \path [, -{Latex[width=2mm]}] (3) edge [bend right] node[right] {$0$} (0);
%    \path [blue,-{Latex[width=2mm]}] (0) edge [bend left] node[right] {$1$} (2);
%    \path [, -{Latex[width=2mm]}] (0) edge [bend right] node[right] {$0$} (2);
%    \path [blue, -{Latex[width=2mm]}] (2) edge [bend left=50] node[right] {$1$} (3);
%\end{tikzpicture}
%\squad $\longrightarrow$ \squad
%\begin{tikzpicture}[minimum size=0.7cm, scale=0.8, baseline=(current bounding box.center)]
%    \node[shape=circle,draw=black] (0) at (0, 0) {$2$};
%    \node[shape=circle,draw=green] (3) at (0, 3) {$1$};
%    \node[shape=circle,draw=black] (2) at (0, -3) {$3$};
%
%    \draw [-{Latex[width=2mm]}] (3) edge [bend left] node[right]  {$0$} (0);
%    \path [-{Latex[width=2mm]}] (3) edge [bend right] node[right] {$0$} (0);
%    \path [-{Latex[width=2mm]}] (0) edge [bend left] node[right] {$0$} (2);
%    \path [-{Latex[width=2mm]}] (0) edge [bend right] node[right] {$0$} (2);
%    \path [-{Latex[width=2mm]}] (2) edge [bend left=50] node[right] {$0$} (3);
%\end{tikzpicture}
%\end{center}
%\caption{Пример работы алгоритма}
%\label{example_algo}
%\end{figure}


\begin{lemma}[Корректность алгоритма разбиения на циклы]
\label{lemma:algo}

Пусть мы запускаем алгоритм на $H \in \mathcal{H}$, а $c$ --- любой цикл, который получается в конце \texttt{шага 2},

$H' \in \mathcal{H}$ --- то, что <<осталось>> от $H$ после нескольких шагов алгоритма.
\begin{enumerate}
\item Если после \texttt{шага 2} получившийся цикл $c$ не внутренний или не нулевой, то в нем есть нулевое внешнее ребро.
\item Алгоритм разобьет $H$ на циклы так, что все ребра в $H'$ в конце алгоритма будут нулевыми.
\end{enumerate}
\end{lemma}
\begin{proof}
Для доказательства утверждений нам понадобится простое, но полезное наблюдение о том, что в ходе алгоритма сохраняется свойство, что в любой вершине сумма входящих ребер равна сумме выходящих.


Сначала покажем, что если цикл $c$ внутренний, то он нулевой. Пусть это не так, тогда в цикле $c$ есть хотя бы одно
ненулевое ребро. Поскольку $c$ внутренний, то все внешние ребра уже отмечены, следовательно все внешние ребра нулевые.
В силу инварианта о равенстве сумм входящих и выходящих чисел на ребрах, получаем, что в $c$ на всех ребрах написаны ненулевые числа, но это противоречит
выбору $c$, который, согласно \texttt{шагу 2}, должен иметь нулевое ребро.  

Таким образом, достаточно рассмотреть случай, когда цикл $c$ не внутренний.
Пусть $e = (v, u)$ --- ребро с нулевым весом в $c$. Если оно внешнее, тогда все доказано. Предположим, что оно внутреннее. Поскольку внутреннее ребро --- последнее среди выходящих из вершины, то ребро $e$ --- последнее из $v$, к тому же число на $e$ --- $0$, поэтому все ребра из $v$ имеют нулевые числа (ребра до $e$ имеют нулевые числа, поскольку они отмечены, а отмечаются только ребра с нулевыми числами). В силу инварианта, все ребра в $v$ также с нулевыми числами и соответственно ребро $e' = (w, v)$ цикла $c$ тоже нулеввым числом. Если оно внешнее, то доказано, иначе оно внутреннее и можно продолжить аналогичные рассуждения. В рассуждениях мы идем сначала от вершины $v$ к $v - 1$, потом $v - 2, \ldots, 1$, $n, \ldots, v + 1$ и показываем, что либо очередное ребро внутреннее и продолжаем, либо ребро внешнее и останавливаемся. Если ни одно ребро не оказалось внешним, то получается, что $c$ --- внутренний цикл, что противоречит предположению.

Только что проведенные рассуждения показывают корректность $\texttt{шага 3}$.
В силу конечности ребер и появления все новых отметок после каждой итерации, алгоритм завершится.
После завершения алгоритма $H'$ будет нулевым, поскольку все внешние ребра будут отмеченными и следовательно нулевыми, внутренние ребра, которые составляют внутренний цикл, будут нулевыми в силу условия остановки. 
\end{proof}


\begin{note}
    \label{note:beta}
    Для любого $H \in \mathcal{H}$ всего будет ровно $\beta$ итераций (запусков \texttt{шага 1}) алгоритма.
\end{note}
\begin{proof}
    
    Каждой итерации кроме последней можно сопоставить биективно внешнее ребро, которое было отмечено на \texttt{шаге 3}.
    Всего внешних ребер $|E| - |V|$, но осталось учесть последнюю итерацию с внутренним циклом, таким образом, всего $|E| - |V| + 1 = \beta$ итераций.
\end{proof}

\subsection{Генерируемые наборы циклов} $ $

Когда мы обсуждали разбиение $H \in \mathcal{H}$ на циклы с помощью алгоритма, мы говорили, что получаем в ответе набор, состоящий из каких-то циклов $c$.
Давайте поймем как описать получающиеся наборы циклов. Для этого введем определение.

Во всех дальнейших обозначениях считаем, что $c_{i}$ --- простой цикл в графе $G$. Простой цикл --- обход графа, в котором первая и последняя вершины равны, а любая другая вершина обхода встречается $1$ раз.

\begin{definition}
    \label{def:generated}
    Набор $(c_{1}, c_{2}, \ldots, c_{k})$ назывется полным набором генерируемых циклов, если 
    \begin{enumerate}
        \item $c_{1}$ получен с использованием $\texttt{шага 1}$ без отмеченных ребер.
        \item $c_{k}$ --- внутренний цикл.
        \item Выполнено $c_{1} \xrightarrow{v_{1}} c_{2} \xrightarrow{v_{2}}c_{3}\xrightarrow{v_{3}} \ldots, \xrightarrow{v_{k - 1}}c_{k}$.
        Запись означает следующее: $v_{j}$ лежит в цикле $c_{j}$, $c_{j + 1}$ был получен из $c_{j}$ отмечанием первого неотмеченного внешнего ребра в $v_{j}$ и запуском $\texttt{шага 1}$.
    \end{enumerate}
    % существует такой набор вершин $\{v_{j}\}_{j = 1}^{k - 1}$, для которого выполнено: $c_{1}$ получен с использованием $\texttt{шага 1}$ без отмеченных ребер, $c_{k}$ --- внутренний цикл, также выполнено выполнено $c_{1} \xrightarrow{v_{1}} c_{2} \xrightarrow{v_{2}}c_{3}\xrightarrow{v_{3}} \ldots, \xrightarrow{v_{k - 1}}c_{k}$.
    % Запись означает следующее: $v_{j}$ лежит в цикле $c_{j}$, $c_{j + 1}$ был получен из $c_{j}$ отмечанием первого неотмеченного внешнего ребра в $v_{j}$ и запуском $\texttt{шага 1}$.
\end{definition}

В ходе построения набора в определении \eqref{def:generated} поддерживается граф с отметками аналогично тому, как это происходит для алгоритма.

% TODO: label for definition 3
% Давайте обоснуем корректность определения $3$. Для+ этого надо показать, что процесс, описанный в алгортиме не будет длиться бесконечно.
% Для этого достаточно показать, что если в ходе алгоритма есть внешнее неотмеченное ребро, то в цикле, полученном с использованием $\texttt{шага 1}$ будет какое-то внешнее ребро.
% Это легко обосновать заметив, что если $i$ --- первая по счету вершина, из которой есть неотмеченное внешнее ребро, то в цикле, полученном с использованием $\texttt{шага 1}$, есть это ребро.

\begin{note}
    \label{note:beta_cycles}
    В полном наборе достижимых циклов всегда ровно $\beta$ циклов.
\end{note}
\begin{proof} $ $

    Каждому циклу кроме последнего можно сопоставить биективно внешнее ребро, которое было отмечено после прохождения этого цикла.
    Всего внешних ребер $|E| - |V|$, но осталось учесть последний внутренний цикл, таким образом, всего $|E| - |V| + 1 = \beta$ циклов в полном наборе.
\end{proof}

\begin{definition} $ $
    \label{gen}
    \begin{enumerate}
        \item Набор $(c_{1}, c_{2}, \ldots, c_{k})$ назывется набором генерируемых циклов, если \\ 
        $(c_{1}, \ldots, c_{k})$ --- подпоследовательность какого-то полного набора генерируемых циклов.
        \item Набор $((c_{1}, a_{1}), (c_{2}, a_{2}), \ldots, (c_{k}, a_{k}))$ называется набором взвешенных генерируемых циклов, если $(c_{1}, c_{2}, \ldots, c_{k})$ --- набор генерируемых циклов, $a_{i} \in \mathbb{N}$ произвольны.
    \end{enumerate}
\end{definition}

\begin{definition} $ $
    \label{def:time}
    \begin{enumerate}
        \item Временем подграфа $G'$ графа $G$ будем считать $t(G') = \sum_{e \in G'}{t(e)}$
        \item Под временем $H \in \mathcal{H}$ будем понимать $t(H) = \sum_{i = 1}^{|E|}{a_{i}t(e_{i})}$, где $a_{i}$ --- число, присвоенное к $i$-ому ребру в графе $H$.
        \item Временем набора взвешенных генерируемых циклов \\ 
        $c = ((c_{1}, a_{1}), (c_{2}, a_{2}), \ldots, (c_{k}, a_{k})), \squad a_{i} \in \mathbb{N}$ называется $t(c) = \sum_{i = 1}^{k}{a_{i}t(c_{i})}$.
    \end{enumerate}
\end{definition}

В $3$ пункте определения \eqref{def:time} $t(c_{i})$ --- время прохождения $i$-ого цикла, $t(c_{i})$ определяется в первом пункте того же определения.

\begin{lemma}
    \label{lemma:sigma}
    Алгоритм задает отображение $\sigma$, которое сопоставляет $H \in \mathcal{H}$ набор взвешенных генерируемых циклов $c = \sigma(H)$ такой, что $t(c) = t(H)$.
\end{lemma}
\begin{proof} $ $

    Давайте запустим алгоритм на $H$ и получим набор циклов 
    
    $((c_{1}, a_{1}), (c_{2}, a_{2}), \ldots, (c_{\beta}, a_{\beta})), \squad a_{i} \in \mathbb{N} \cup \{0\}$.

    Здесь все циклы взяты с соответствующей итерации алгоритма. Всего циклов $\beta$ в силу замечания \eqref{note:beta}.
    По лемме \eqref{lemma:algo} получаем, что $\sum_{i = 1}^{\beta}{a_{i}t(c_{i})} = t(H)$.
    Заметим, что для $(c_{1}, \ldots, c_{\beta})$ выполнены все условия полного набора генерируемых циклов.
    Отбросим циклы с $a_{i} = 0$ и получим искомый набор взвешенных генерируемых циклов.
\end{proof}

Пусть $T = \sum_{i = 1}^{|E|}{a_{i}t(e_{i})}, \squad a_{i} \in \mathbb{N} \cup \{0\}$. Построим граф $H$, в котором на ребре $e_{i}$ написано $a_{i}$. Определим $\omega(T) = H$. Тем самым мы задали функцию $\omega$.

Введем функцию $\mu = \sigma \circ \omega$.

Функция $\sigma$ <<запускает>> на графе $H \in \mathcal{H}$ алгоритм и выдает результат. Функция $\omega$ дает по времени граф, у которого есть информация сколько раз по каждому ребру прошли.
В определении $\omega$ граф существует в силу выбора $T$, на которых определена функция $\omega$ и $\omega(T)$ задан единственным образом в силу линейной независимости над $\mathbb{Q}$ времен ребер.
Следует обратить внимание на то, что функция $\omega$ определена не для любых времен, а только для времен особого вида (линейных комбинаций длин ребер с целыми неотрицательными весами).

\begin{note}
    \label{note:time_inv}
    Функция $\mu$ сохраняет время, то есть $t(\mu(T)) = t(\sigma(\omega(T))) = T$, если $\omega(T) \in \mathcal{H}$ и $T = \sum_{i = 1}^{|E|}{a_{i}t(e_{i})}, \squad a_{i} \in \mathbb{N} \cup \{0\}$.
\end{note}
\begin{proof}
    Немедленно следует из того, что $t(\omega(T)) = T$ и леммы \eqref{lemma:sigma}.
\end{proof}
\begin{definition}
    Пусть $\mathcal{T}$ --- множество всех времен захода в стартовую вершину.
\end{definition}

% Вообще, чтобы посчитать $N_{1}(T)$ нас интересуют времена захода путей из стартовой вершины в нее же, а не $t(H)$ для произвольных $H \in \mathcal{H}$, но следующее предложение показывает, что если мы посчитаем все


\begin{lemma}
    \label{lemma:generated}
    Для любого времени $T \in \mathcal{T}$ существует набор взвешенных генерируемых циклов $c = \mu(T)$, что $t(c) = T$. 
\end{lemma}
\begin{proof}
    Возьмем $H = \omega(T)$. Поскольку $T \in \mathcal{T}$, то $H \in \mathcal{H}$. По лемме \eqref{lemma:sigma} к $H$ применима $\sigma$. Можем взять $c = \mu(T)$.
    По замечанию \eqref{note:time_inv} $t(c) = t(\mu(T)) = T$. 
\end{proof}

\subsection{Достижимые наборы циклов} $ $

Лемма \eqref{lemma:generated} показывает, что мы можем сопоставить времени $T \in \mathcal{T}$ взвешенный набор генерируемых циклов $c$ со временем $T$ c помощью $\mu$, но обратное неверно. То есть если взять произвольный набор взвешенных генерируемых циклов $c$, то не обязательно существует $\mu^{-1}(c)$.

Теперь мы хотим это исправить и сделать так, чтобы между $\mathcal{T}$ и каким-то множеством наборов взвешенных генерируемых циклов была биекция, задаваемая функцией $\mu$. Заметим, что инъекция уже есть. Действительно, разные $T_{1} \neq T_{2}$ будут давать $\mu(T_{1}) \neq \mu(T_{2})$, поскольку
$t(\mu(T_{1})) = T_{1}$, $t(\mu(T_{2})) = T_{2}$ и $T_{1} \neq T_{2}$ по предположению.  Для биекции осталось получить сюръекцию, но ее просто сделать: необходимо ограничить множество всех взвешенных генерируемых циклов до $\mu(\mathcal{T})$.

Получается, что есть какое-то <<хорошее>> множество $\mu(\mathcal{T})$ наборов взвешенных генерируемых циклов.

Давайте теперь поймем как с помощью $\mu(\mathcal{T})$ считать $N_{1}(T)$.

\begin{note}
    \label{note:time_to_reachable}
    Для любого времени $T > 0$ выполнено
    \begin{gather*}
        N_{1}(T) = \#\{t \in \mathcal{T}: t \leq T\} = \#\{c \in \mu(\mathcal{T}): t(c) \leq T\}
    \end{gather*}
\end{note}
\begin{proof}
    Первое равенство выполнено по определению $N_{1}(T)$.
    Второе выполнено в силу того, что $\mu$ --- биекция между $\mathcal{T}$ и $\mu(\mathcal{T})$, которая сохраняет время.
\end{proof}

Таким образом, целесообразно ввести новый вид набора взвешенных генерируемых циклов.
Для этого вида мы будем требовать $c \in \mu(\mathcal{T})$.
Однако давайте введем этот вид немного по-другому, чтобы было удобнее использовать определение в доказательствах, а потом докажем эквивалентность тому, что мы писали в предыдущем предложении.

% \begin{definition}
%     \label{def:reachable_weighted_simple}
%     Набор $c = ((c_{1}, a_{1}), (c_{2}, a_{2}), \ldots, (c_{k}, a_{k}))$ назывется набором взвешенных достижимых циклов, если
%     \begin{enumerate}
%          \item Набор $c$ является набором взвешенных генерируемых циклов.
%          \item $c \in \mu(\mathcal{T})$
%     \end{enumerate}
% \end{definition}

\begin{definition}
    \label{def:reachable_weighted}

    Набор $c = ((c_{1}, a_{1}), (c_{2}, a_{2}), \ldots, (c_{k}, a_{k}))$ является набором взвешенных достижимых циклов тогда и только тогда, когда
    \begin{enumerate}
         \item Набор $c$ является набором взвешенных генерируемых циклов.
         \item $\mu(t(c)) = c$.
         \item $t(c) \in \mathcal{T}$.
    \end{enumerate}
\end{definition}

\begin{note} $ $
    \label{note:equiv}
    $c$ --- набор взвешенных достижимых циклов $\Leftrightarrow$ $c \in \mu(\mathcal{T})$. 
\end{note}
\begin{proof} $ $
    
    Слева направо:
    
    Достаточно показать $c \in \mu(\mathcal{T})$, но $c = \mu(t(c)), \squad t(c) \in \mathcal{T}$.

    Справа налево:

    $c \in \mu(\mathcal{T}) \Rightarrow c = \mu(t'), t' \in \mathcal{T}$, но $t(c) = t(\mu(t')) = t' \Rightarrow \mu(t(c)) = c, \squad t(c) \in \mathcal{T}$.
    
\end{proof}

Смысл условия $2$ определения \eqref{def:reachable_weighted} в том, что набор $c$ будет получаться как результат алгоритма на $\omega(t(c))$. В этом смысле он <<достижим>>.

% Можно показать, что определение \eqref{def:reachable_weighted} 

\begin{lemma}
    \label{lemma:induction}
    Если $c = ((c_{1}, a_{1}), (c_{2}, a_{2}), \ldots, (c_{k}, a_{k}))$ --- набор взвешенных достижимых циклов, то

    \noindent
    $c' = ((c_{1}, b_{1}), (c_{2}, b_{2}), \ldots, (c_{k}, b_{k})), \squad b_{i} \in \mathbb{N}$ тоже набор взвешенных достижимых циклов.
\end{lemma}
\begin{proof} $ $

    Первое условие выполнено по определению набора взвешенных генерируемых циклов.
    Заметим, что условие $3$ определения для $c$ эквивалентно тому, что $\omega(t(c))$ --- эйлеров граф, содержащий вершину $1$, если требовать число проходов по ребру быть равным числу на ребре.
    Поскольку в $\omega(t(c))$ и $\omega(t(c'))$ одинаковое множество ненулевых ребер, то по теореме об эйлеровости графа, $\omega(t(c'))$ тоже эйлеров.  

    Осталось показать, что выполнено второе условие. Пусть $d = \mu(t(c'))$, $d = ((d_{1}, x_{1}), \ldots, (d_{k}, x_{k}))$. Нужно показать $c' = d$.
    Поскольку $c$, $d$ --- наборы взвешенных генерируемых циклов, то допустимо следующее представление:
    \begin{align*}
         &\xrightarrow{V_{0}} (c_{1}, a_{1}) \xrightarrow{V_{1}} (c_{2}, a_{2}) \ldots (c_{k - 1}, a_{k - 1}) \xrightarrow{V_{k - 1}} (c_{k}, a_{k}), \squad V_{i} = (V_{i}^{1} \ldots V_{i}^{s_{i}}) \lor \varnothing \\
         &\xrightarrow{U_{0}} (d_{1}, x_{1}) \xrightarrow{U_{1}} (d_{2}, x_{2}) \ldots (d_{w - 1}, x_{w - 1}) \xrightarrow{U_{w - 1}} (d_{w}, x_{w}), \squad U_{i} = (U_{i}^{1} \ldots U_{i}^{p_{i}}) \lor \varnothing \\
    \end{align*}

    Здесь $V_{i}$ и $U_{i}$ обозначают набор вершин, на ребрах из которых происходили отметки между циклами $c_{i - 1}$ и $c_{i}$ или $d_{i - 1}$ и $d_{i}$.

    Пусть алгоритм прошел до $(d_{i}, x_{i}), \squad i \in \{1, \ldots, w\}$ в $d$, взял цикл $d_{i}$ $x_{i}$ раз и остановился, тогда
    \begin{enumerate}
        \item $i \leq k$, $\forall j \leq i \squad d_{j} = c_{j}$, $x_{j} = b_{j}$ \\
        \item Состояние алгоритма (для всех вершин первое неотмеченное ребро) равно состоянию алгоритма, если бы он прошел до $(c_{i}, a_{i})$ в $c$, взял цикл $c_{i}$ $a_{i}$ раз и остановился.
    \end{enumerate}
    Докажем это по индукции. База индукции при $i = 0$: первое утверждение очевидно выполнено, второе выполнено, поскольку изначально одинаковое состояние.
Обсудим индукционный переход. Пусть всё выполнено для $i$, докажем для $i + 1$:
    Пусть $G_{c} = \omega(t(c)), \squad G_{d} = \omega(t(d)) = \sum_{j = 1}^{w}{x_{j}d_{j}}$. По определению $d$, $G_{d} = \omega(t(c'))$. Также пусть $G_{d}^{i}$ --- граф, который получился после прохождения алгоритма до $(d_{i}, x_{i})$ включительно, аналогично определяется $G_{c}^{i}$.
    Заметим следующее:
    \begin{align*}
        G_{d}^{i} &= \sum_{j = i + 1}^{w}{x_{j}d_{j}} = \sum_{j = 1}^{w}{x_{j}d_{j}} - \sum_{j = 1}^{i}{x_{j}d_{j}} \\
                  &= \left[\text{По предположению индукции}\right] \sum_{j = 1}^{w}{x_{j}d_{j}} - \sum_{j = 1}^{i}{b_{j}c_{j}}  = G_{d} - \sum_{j = 1}^{i}{b_{j}c_{j}} \\
                  &= \omega(t(c')) - \sum_{j = 1}^{i}{b_{j}c_{j}} = \sum_{j = 1}^{k}{b_{j}c_{j}} - \sum_{j = 1}^{i}{b_{j}c_{j}} = \sum_{j = i + 1}^{k}{b_{j}c_{j}}. \\
    \end{align*}

    Поскольку в $G_{d}^{i} = \sum_{j = i + 1}^{k}{b_{j}c_{j}}$ есть ребра с ненулевым весом, то $k \geq i + 1$.
    Заметим, что поскольку $G_{c}^{i} = \sum_{j = i + 1}^{k}{a_{j}c_{j}}$, то в $G_{c}^{i}$ и $G_{d}^{i}$ совпадает множество ребер с ненулевым весом. Рассмотрим $V_{i} = (V_{i}^{1} \ldots V_{i}^{s_{i}})$ и $U_{i} = (U_{i}^{1} \ldots U_{i}^{p_{i}})$. Поскольку состояния одинаковые после $(c_{i}, a_{i})$ в $c$ и $(d_{i}, x_{i})$ в $d$ и множество ребер с ненулевым весом одинаковое, то циклы в данный момент будут одинаковыми и отметка пойдет на одни и те же ребра, то есть $V_{i}^{1} = U_{i}^{1}$. Заметим, что опять состояние одинаковое, мы не поменяли числа на ребрах, поэтому так же множество ребер с нулевым весом совпадает, то есть $V_{i}^{2} = U_{i}^{2}$. Не может быть так, что $s_{i} \neq p_{i}$, потому что тогда бы в каком-то цикле было ребро с нулевым весом, а в том же цикле но в другом наборе оно было бы с ненулевым весом, то есть $V_{i} = U_{i}$. Другими словами мы дошли до $(c_{i + 1}, a_{i + 1})$ и $(d_{i + 1}, x_{i + 1})$. Поскольку $V_{i} = U_{i}$, то состояние одинаковое, то есть $c_{i + 1} = d_{i + 1}$.

    $G_{d}^{i} = b_{i + 1}c_{i + 1} + \sum_{j = i + 2}^{k}{b_{j}c_{j}}$. Если $k = i + 1$, то $G_{d}^{i} = b_{i + 1}c_{i + 1}$ и $x_{i + 1} = b_{i + 1}$, иначе посмотрим на ребро, которое было отмечено $V_{i + 1}^{1}$. Оно входит в цикл $c_{i + 1}$ и используется ровно $b_{i + 1}$ раз. Все остальные ребра цикла используются $\geq b_{i + 1}$ раз. То есть цикл $c_{i + 1}$ будет вычитаться ровно $b_{i + 1}$ раз, $x_{i + 1} = b_{i + 1}$.

    \medskip

    Получаем, что $k \geq w, \squad \forall j \leq w$ $c_{j} = d_{j}, \squad x_{j} = b_{j}$. То есть $d$ --- префикс $c'$, если $k > w$,
    то $\omega(t(c')) \neq \omega(t(d))$, таким образом $k = w$ и $c' = d$.
\end{proof}


\begin{definition}
    \label{def:reachable}
    Набор $(c_{1}, c_{2}, \ldots, c_{k})$ называется набором достижимых циклов, если $((c_{1}, 1), (c_{2}, 1), \ldots, (c_{k}, 1))$ является набором взвешенных достижимых\\
     циклов.
\end{definition}

Определение \eqref{def:reachable} подразумевает, что если $(c_{1}, c_{2}, \ldots, c_{k})$ --- набор достижимых циклов, то любой взвешенный набор с этимим циклами является взвешенным достижимым, и наоборот, если $(c_{1}, c_{2}, \ldots, c_{k})$ является генерируемым, но не достижимым, то любой взвешенный набор не будет взвешенным достижимым. Это верно в силу леммы \eqref{lemma:induction}.


\begin{definition}
    \label{def:reachable_length}
    Обозначим через $D_{k}$ --- множество всех наборов достижимых циклов длины $k$.
\end{definition}

\begin{note}
    \label{note:sqcup}
    Множество всех наборов взвешенных достижимых циклов 
    
    можно представить в виде
    \begin{gather*}
        \bigsqcup_{i = 1}^{\beta}\bigsqcup_{d \in D_{i}}\bigsqcup_{(n_{1}, \ldots, n_{i}), n_{j} \in \mathbb{N}}((d_{1}, n_{1}), \ldots, (d_{i}, n_{i})) \\
    \end{gather*}
\end{note}
\begin{proof}
    Выполнено в силу леммы \eqref{lemma:induction} и определения \eqref{def:reachable_length}.
\end{proof}

\subsection{Формула для \texorpdfstring{$N_{1}(T)$}{}}

Мы готовы сформулировать утверждение о точной формуле для $N_{1}(T)$.



\begin{theorem}
\label{theorem:N_1}
Для $N_{1}(T)$, то есть количества моментов времени $\leq T$, таких, что в вершину номер $1$ заходили точки справедливо следующее соотношение:
    \begin{gather*}
        N_{1}(T) = \sum_{i = 1}^{\beta}{\sum_{d \in D_{i}}{\#\left\{\sum_{j = 1}^{i}{n_{j}t(d_{j}) \leq T, \squad n_{j} \in \mathbb{N}}\right\}}}
    \end{gather*}
\end{theorem}

\begin{proof}
    \begin{align*}
        N_{1}(T) &= [\text{по определению}] \#\{t \in \mathcal{T}: t \leq T\} = \\ 
                 &= [\text{по замечанию \eqref{note:time_to_reachable}}] \#\{c \in \mu(\mathcal{T}): t(c) \leq T\} \\
                 &= [\text{по замечанию \eqref{note:equiv} и \eqref{note:sqcup}}] \\
                 &\#\left\{c \in \bigsqcup_{i = 1}^{\beta}\bigsqcup_{d \in D_{i}}\bigsqcup_{(n_{1}, \ldots, n_{i}), n_{j} \in \mathbb{N}}((d_{1}, n_{1}), \ldots, (d_{i}, n_{i})): t(c) \leq T\right\} \\
                 &= \sum_{i = 1}^{\beta}{\sum_{d \in D_{i}}{\#\left\{\sum_{j = 1}^{i}{n_{j}t(d_{j}) \leq T, \squad n_{j} \in \mathbb{N}}\right\}}}
    \end{align*}
\end{proof}

\subsection{\texorpdfstring{Наборы взвешенных генерируемых циклов длины $\beta$}{}}

\begin{definition}
    Определим
    \begin{gather*}
        cnt_{[l;r]}^{c}(e) = \sum_{i = l}^{r}{a_{i} \cdot I\{e \in c_{i}\}},
    \end{gather*}
    где $I\{X\}$ --- индикатор истинности $X$, $e \in E, \squad c = ((c_{1}, a_{1}), \ldots, (c_{p}, a_{p}))$ --- набор взвешенных достижимых циклов.
\end{definition}


\begin{lemma} $ $
    \label{lemma:eq}
        Если $c = ((c_{1}, a_{1}), \ldots, (c_{p}, a_{p}))$, $d = ((d_{1}, b_{1}), \ldots, (d_{k}, b_{k}))$ --- два набора взвешенных генерируемых циклов таковы, что $\exists i: \forall j, \squad 1 \leq j < i \squad c_{j} = d_{j} \land a_{j} = b_{j}, \squad c_{i} = d_{i} \land a_{i} \neq b_{i}$, то $t(c) \neq t(d)$.
\end{lemma}
\begin{proof} $ $
    Допустим противное, $t(c) = t(d)$.
    Поскольку длины всех ребер линейно независимы над $\mathbb{Q}$, то для любого $e \in E$ должно быть выполнено $cnt_{[1;p]}^{c}(e) = cnt_{[1;k]}^{d}(e)$. Посмотрим на последовательность отметок.

    Возьмем $i$ из условия. Будем предполагать, что $i < p \land i < k$ (Если $i = p \land i = k$, то очевидно, иначе пусть, например, $i = p, \squad i < k$, тогда в наборе $d$ после $d_{p}$ произойдет отметка, и в новом неотмеченном ребре будет разным $cnt$ по всему набору).
    
    Посмотрим на то, как получился цикл $c_{i + 1}$ из $c_{i}$ и $d_{i + 1}$
    из $d_{i}$. Пусть для $c_{i + 1}$ произошли отметки на $v_{1}, \ldots, v_{s}$, а для $d_{i + 1}$ на $u_{1}, \ldots, u_{t}$.

    Пусть $v_{1} = u_{1}$, обозначим за $e_{v}$ ребро, которое отметили. Получаем
    \begin{gather*}
        cnt_{[1;p]}^{c}(e_{v}) = cnt_{[1;i - 1]}^{c}(e_{v}) + a_{i} \\
        cnt_{[1;k]}^{d}(e_{v}) = cnt_{[1;i - 1]}^{d}(e_{v}) + b_{i},
    \end{gather*}
    но $cnt_{[1;i - 1]}^{c}(e_{v}) = cnt_{[1;i - 1]}^{d}(e_{v})$, а $a_{i} \neq b_{i}$ $\Rightarrow$ $cnt_{[1;p]}^{c}(e_{v}) \neq cnt_{[1;k]}^{d}(e_{v})$. Противоречие.

    Пусть теперь $v_{1} \neq u_{1}$. Ребро, которое отметили в $c$ обозначим за $e_{v}$, а в $d$ за $e_{u}$. Получаем неравенства

    \begin{equation*}
        \begin{aligned}[c]
        cnt_{[1;p]}^{c}(e_{v}) &= cnt_{[1;i - 1]}^{c}(e_{v}) + a_{i} \\
        cnt_{[1;k]}^{d}(e_{v}) &\geq cnt_{[1;i - 1]}^{d}(e_{v}) + b_{i} \\
        &\Downarrow \\
        b_{i} &\leq a_{i} \\
        \end{aligned}
        \qquad
        \begin{aligned}[c]
        cnt_{[1;k]}^{d}(e_{u}) &= cnt_{[1;i - 1]}^{d}(e_{u}) + b_{i} \\
        cnt_{[1;p]}^{c}(e_{u}) &\geq cnt_{[1;i - 1]}^{c}(e_{u}) + a_{i} \\
        &\Downarrow \\
        a_{i} &\leq b_{i} \\
        \end{aligned}
    \end{equation*}
    Получаем $a_{i} = b_{i}$, противоречие.
\end{proof}

\begin{definition}
    Будем называть два набора взвешенных генерируемых циклов $c = ((c_{1}, a_{1}), \ldots, (c_{m}, a_{m}))$ и $d = ((d_{1}, b_{1}), \ldots, (d_{k}, b_{k}))$ одинаковыми и обозначать как $c = d$, если $m = k$ и $\forall i \leq m$ $c_{i} = d_{i}$ и $a_{i} = b_{i}$.
    В противном случае будем считать их разными и обозначать как $c \neq d$.
\end{definition}

\begin{lemma} $ $
        \label{lemma:beta}
        Если $c = ((c_{1}, a_{1}), \ldots, (c_{\beta}, a_{\beta}))$ и $d = ((d_{1}, b_{1}), \ldots, (d_{k}, b_{k})), \squad k \leq \beta$ --- два разных набора взвешенных генерируемых циклов, то $t(c) \neq t(d)$.
\end{lemma}
\begin{proof} $ $

    Для удобства сравнения записей, будем считать, что если до первого цикла нет отметок, то есть <<пустая отметка>>.
    Поскольку $d$ --- набор взвешенных достижимых циклов, то $d' = (d_{1}, \ldots, d_{k})$ --- набор генерируемых циклов, а они являются подпоследовательностью какого-то полного набора генерируемых циклов, то $d'$ можно записать как $\xrightarrow{U_{0}} d_{1} \xrightarrow{U_{1}}d_{2}\xrightarrow{U_{2}}d_{3}\ldots d_{k - 1}\xrightarrow{U_{k - 1}}d_{k}, \squad U_{i} = (U_{i}^{1},\ldots, U_{i}^{s_{i}}) \lor \varnothing$, а взвешенный набор можно записать как\\
     $\xrightarrow{U_{0}} (d_{1}, b_{1}) \xrightarrow{U_{1}}(d_{2}, b_{2})\xrightarrow{U_{2}}(d_{3}, b_{3})\ldots (d_{k - 1}, b_{k - 1})\xrightarrow{U_{k - 1}}(d_{k}, b_{k})$.

    В свою очередь для $c$ справедливо следующее представление:
    \begin{gather*}
        (c_{1}, a_{1}) \xrightarrow{V_{1}}(c_{2}, a_{2}) \xrightarrow{V_{2}}(c_{3}, a_{3}) \ldots (c_{\beta - 1}, a_{\beta - 1}) \xrightarrow{V_{\beta - 1}} (c_{\beta}, a_{\beta}), \\
        \squad V_{i} = (v_{i}), \squad i \in \{1, \ldots, \beta - 1\}
    \end{gather*}

    Рассмотрим два случая. Первый: $U_{0} \neq \varnothing$. Пусть $U_{0} = (u, \ldots)$ и $e_{u}$ --- ребро, которое было отмечено после первого прохождения $u$, тогда $cnt_{[1; k]}^{d}(e_{u}) = 0$, $cnt_{[1; \beta]}^{c}(e_{u}) > 0$. Получаем $t(c) \neq t(d)$.

    Второй случай: $U_{0} = \varnothing$. Поскольку $U_{0} = \varnothing$, то $\sigma = (d_{1}, b_{1}) \xrightarrow{U_{1}}(d_{2}, b_{2})\xrightarrow{U_{2}}(d_{3}, b_{3})\ldots (d_{k - 1}, b_{k - 1})\xrightarrow{U_{k - 1}}(d_{k}, b_{k})$.

    Заметим, что представления состоят из двух типов объектов: $(\cdot, \cdot)$ и $\xrightarrow{\cdot}$. Будем идти слева направо и сравнивать для $(\cdot, \cdot)$ $a_{i}$ и $b_{i}$, а для $\xrightarrow{\cdot}$ будем сравнивать наборы $V_{i}$ и $U_{i}$ как мультимножества.
    Если таким образом один собственный префикс другого, то очевидно $t(c) \neq t(d)$.
    Иначе существует $i: a_{i} \neq b_{i} \lor V_{i} \neq U_{i}$.
    В первом случае, когда $U_{i} = V_{i}$ и $a_{i} \neq b_{i}$ можно заметить, что $\forall j < i$ $c_{j} = d_{j} \land a_{j} = b_{j}$, $c_{i} = d_{i} \land a_{i} \neq b_{i}$. По лемме \eqref{lemma:eq} получаем, что $t(c) \neq t(d)$.
    Во втором случае $V_{i} \neq U_{i}$. Это значит, что есть внешнее ребро $e_{u}$, которое было отмечено в $d$, но пока не было отмечено в $c$, но поскольку $c$ --- полный набор взвешенных циклов, то в какой-то момент в будущем мы переключимся c этого ребра дальше, но поскольку это произойдет после $\xrightarrow{V_{i}}$, то $cnt_{[i + 1;\beta]}^{c}(e_{u}) > 0$, но $cnt_{[i + 1; k]}^{d}(e_{u}) = 0$.

    \begin{gather*}
        cnt_{[1; \beta]}^{c}(e_{u}) = cnt_{[1; i]}^{c}({e_{u}}) + \underbrace{cnt_{[i + 1; \beta]}^{c}(e_{u})}_{> 0} \\
        cnt_{[1; k]}^{d}(e_{u}) = cnt_{[1; i]}^{d}(e_{u}) + \underbrace{cnt_{[i + 1; k]}^{d}(e_{u})}_{= 0} \\
        \Downarrow \\
        cnt_{[1; \beta]}^{c}(e_{u}) \neq cnt_{[1; k]}^{d}(e_{u}) \\
        \Downarrow \\
        t(c) \neq t(d)
    \end{gather*}
\end{proof}

\begin{lemma}
    \label{lemma:beta_reachable}
    Пусть $c = (c_{1}, \ldots, c_{\beta})$ --- набор генерируемых циклов длины $\beta$,
    тогда $c$ также набор достижимых циклов длины $\beta$.
\end{lemma}
\begin{proof}
    По определению \eqref{def:reachable} достаточно проверить, что \\ 
    $c' = ((c_{1}, 1), \ldots, (c_{\beta}, 1))$ --- набор взвешенных достижимых циклов. Для него, в свою очередь, надо проверить, что выполнены условия в определении \eqref{def:reachable_weighted}.
    Третье условие выполнено, так как $c_{\beta}$ --- внутренний цикл, который проходит по всем вершинам, соответственно, если проходить по ребру число раз, которое написано на ребре, то получаем, что граф эйлеров.
    Проверим второе условие. Рассмотрим $d = \mu(t(c'))$, имеем $t(c') = t(d)$. Но по лемме \eqref{lemma:beta} получаем $c' = d$.
\end{proof}


\section{Подсчет старшего коэффициента}

\subsection{Результаты для произвольного ориентированного сильно связного графа $G$}

Следующая лемма справедлива для любого ориентированного сильно связного графа $G = (V, E)$ с линейно независимыми над $\mathbb{Q}$ ребрами, не обязательно гамильтонова.

Обозначим за $N_{\tau, e, r}(T)$ количество точек в момент времени $T$ на отрезка длины $\tau$, который находится на расстоянии $r$ от начала ребра $e$.

\begin{lemma} $ $
\label{pg}
Пусть нам известно, что число возможных движущихся точек, вошедших в первую вершину к моменту времени $T$ можно представить в виде: $N_{1}(T) = a_{1}T^{\beta} + b_{1}T^{\beta - 1} + O(T^{\beta - 2})$ и пусть $r$ --- расстояние до вершины $1$ от начала отрезка, тогда:
\begin{enumerate}
    % \item $N_{1}(T) = a_{1}T^{\beta} + b_{1}T^{\beta - 1} + O(T^{\beta - 2})$, где $a_{1} = \sum_{d \in D_{\beta}}\frac{1}{\beta!\prod_{i = 1}^{\beta}{d_{i}}}$
    % \item $N_{i}(T) = a_{i}T^{\beta} + b_{i}T^{\beta - 1} + O(T^{\beta - 2}) \squad \forall i \in \{1, \ldots, n\}$, где $a_{i} = a_{1}$
    \item $N_{\tau, e, r}(T) = \tau \cdot a_{1} \cdot \beta \cdot T^{\beta - 1} + O(T^{\beta - 2}) \squad \forall e = (1, v) \in E$, $\tau > 0$
    \item $N_{\tau, e, r}(T) = \tau \cdot a_{1} \cdot \beta \cdot T^{\beta - 1} + O(T^{\beta - 2}) \squad \forall e \in E$, $\tau > 0$
    \item $N(T) = \left(\sum_{e \in E}{t(e)}\right) \cdot a_{1} \cdot \beta \cdot T^{\beta - 1} + O(T^{\beta - 2}).$
\end{enumerate}
\end{lemma}
\begin{proof} $ $

\begin{enumerate}
    % \item По \eqref{imp} достаточно просуммировать по всем возможным линейным комбинациям циклов достижимых наборов, но по известной асимптотической формуле, достаточно взять только все наборы длины $\beta$ и $\beta - 1$. Получаем искомое.
    % \item Есть путь от $1$ до $i$ длины $p_{1}$ и обратно длины $p_{2}$.

    % Получаем
    % \begin{gather*}
    %     N_{1}(T - p_{1}) \leq N_{i}(T) \leq N_{i}(T + p_{2}) \\
    %     a_{1}T^{\beta} + b'T^{\beta - 1} \leq N_{i}(T) \leq a_{1}T^{\beta} + b''T^{\beta - 1} \\
    %     \Downarrow \\
    %     N_{i}(T) = a_{1}T^{\beta} + O(T^{\beta - 1}) \\
    % \end{gather*}
    % \textit{Доказательства $N_{i}(T) = a_{1}T^{\beta} + b_{i}T^{\beta - 1} + O(T^{\beta - 2})$ пока нет, но, надеюсь, что скоро будет. Есть один вариант, но там много писать и он до конца не проработан.}
    \item
    Если $r$ --- расстояние до вершины $1$ от начала отрезка и $T' = T - r$, то
    % {\color{red} небольшой фикс нужен, нужно сделать замену переменной $T$, поскольку отрезок не обязательно в начале.}
    \begin{gather*}
        N_{\tau, e, r}(T) = N_{1}(T') - N_{1}(T' - \tau) + O(1) =\\ 
        a_{1}T'^{\beta} + b_{1}T'^{\beta - 1} - (a_{1}(T' - \tau)^{\beta} + b_{1}(T' - \tau)^{\beta - 1}) + O(T'^{\beta - 2}) = \\
        = \tau a_{1} \beta T'^{\beta - 1} + O(T'^{\beta - 2}) =\tau a_{1} \beta T^{\beta - 1} + O(T^{\beta - 2}) \\
    \end{gather*}
    \item
        Докажем сначала для ребер длины $\tau = \varepsilon < t(e), \forall e \in E$.
        Отложим отрезок на ребре $e$ длины $\varepsilon$ и отрезок длины $\varepsilon$ на ребре $e_{1}$,
        которое выходит из $1$ и от которого можно дойти до $e$. Пусть от конца отрезка на ребре $e$ до конца отрезка на ребре $e_{1}$ путь длины $p_{1}$, а от конца отрезка на ребре $e_{1}$ до конца отрезка на ребре $e$ путь длины $p_{2}$.
        \begin{gather*}
            N_{\varepsilon, e_{1}, r_{1}}(T - p_{2}) \leq N_{\varepsilon, e, r_{2}}(T) \leq N_{\varepsilon, e_{1}, r_{1}}(T + p_{1}) \\
            \varepsilon a_{1} \beta T^{\beta - 1} + O(T^{\beta - 2}) \leq N_{\varepsilon, e, r_{2}}(T) \leq \varepsilon a_{1} \beta T^{\beta - 1} + O(T^{\beta - 2}) \\
            \Downarrow \\
            N_{\varepsilon, e, r_{2}}(T) = \varepsilon a_{1} \beta T^{\beta - 1} + O(T^{\beta - 2})
        \end{gather*}
        Рассмотрим остальные значения $\tau$.
        Замостим отрезок длины $\tau$ отрезками длины $\leq \min\{t(e), e \in E\}$, то есть $ \{l_{i}\}_{i = 1}^{k}, \squad \sum_{i = 1}^{k}{l_{i}} = \tau, \squad l_{i}\leq \min\{t(e), e \in E\}$.
        Получаем:
        \begin{gather*}
            N_{\tau, e, r}(T) = \sum_{i = 1}^{k}{\left(N_{l_{i}, e, r_{i}}(T) + O(1)\right)} =\sum_{i = 1}^{k}{(l_{i} a_{1} \beta T^{\beta - 1} + O(T^{\beta - 2}))} = \\
            \left(\sum_{i = 1}^{k}{l_{i}}\right) a_{1} \beta T^{\beta - 1} + O(T^{\beta - 2}) = \tau a_{1} \beta T^{\beta - 1} + O(T^{\beta - 2}).
        \end{gather*}

    \item
        $N(T)$ --- количество точек на графе в момент времени $T$, это количество можно получить как сумму количеств точек на каждом ребре в момент времени $T$. Имеем:
        \begin{gather*}
            N(T) = \sum_{e \in E}{N_{t(e), e, 0}(T)} = \left(\sum_{e \in E}{t(e)}\right) a_{1}  \beta  T^{\beta - 1} + O(T^{\beta - 2}) \\
        \end{gather*}
\end{enumerate}
\end{proof}

Из только что полученного утверждения следует утверждение о асимптотически равноменом распределении движущихся точек.

\begin{corollary}[О равномерности распределения]
Пусть нам известно, что число возможных движущихся точек, вошедших в первую вершину к моменту времени $T$ можно представить в виде: $N_{1}(T) = a_{1}T^{\beta} + b_{1}T^{\beta - 1} + O(T^{\beta - 2})$, тогда доля числа движущихся точек на произвольном отрезке длины $\tau$ будет асимптотически стремиться к доле отрезка в суммарной длине нашего метрического графа, а именно:
    $\frac{N_{\tau, e}(T)}{N(T)} \xrightarrow{T \to +\infty} \frac{\tau}{\sum_{e \in E}{t(e)}}$
\end{corollary}

\begin{proof} $ $

    Воспользуемся пунктами $2$ и $3$ леммы \eqref{pg}.
    \begin{align*}
        \lim_{T \to +\infty}{\frac{N_{\tau, e}(T)}{N(T)}} = \lim_{T \to +\infty}{\frac{\tau a_{1} \beta + O\left(\frac{1}{T}\right)}{\left(\sum_{e \in E}{t(e)}\right) a_{1} \beta + O(\frac{1}{T})}} =\\
        &= \frac{\tau}{\sum_{e \in E}{t(e)}}. \\
    \end{align*}
\end{proof}

\subsection{Гамильтоновы графы} $ $

Теперь вернемся к гамильтоновым графам, которые описаны в $1.1$.
\begin{lemma}
    \label{lemma:linear_independent}
    Если $c = (c_{1}, \ldots, c_{k})$ --- набор генерируемых циклов, а граф --- гамильтонов, то $\{t(c_{1}), \ldots, t(c_{k})\}$ линейно независимы над $\mathbb{Q}$
\end{lemma}
\begin{proof} $ $

  Допустим противное и $\exists (\alpha_{1}, \ldots, \alpha_{k}) \neq (0, \ldots, 0)$, что $\sum_{i = 1}^{k}{\alpha_{i}t(c_{i})} = 0$. Можно считать, что $\alpha_{i} \in \mathbb{Z}$. Известно, что $c$ --- подпоследовательность полного достижимого набора $d$ (набора длины $\beta$). Положим $\gamma = \max_{i = 1}^{k}{|\alpha_{i}| + 1}$, получаем
    \begin{align*}
        \sum_{i = 1}^{k}{\alpha_{i}t(c_{i})} &= 0 \\
        \sum_{i = 1}^{\beta}{(\alpha_{i}' + \gamma)t(d_{i})} &= \sum_{i = 1}^{\beta}{\gamma t(d_{i})}, \squad (\alpha_{i}' + \gamma) > 0 \\
    \end{align*}
    $\alpha'$ получена из $\alpha$ расширением до длины $\beta$ нулями на тех позициях, на которых нет элемента из $c$ в $d$.
    
    $(\alpha_{1}, \ldots, \alpha_{k}) \neq (0, \ldots, 0) \Rightarrow (\alpha_{1}' + \gamma, \ldots, \alpha_{\beta}' + \gamma) \neq (\gamma, \ldots, \gamma)$.
    Это противоречит лемме \eqref{lemma:beta}.
\end{proof}


Мы готовы сформулировать основной результат.

\begin{theorem}[Об асимптотике числа конечных положений случайного блуждания на гамильтоновом орграфе]
    \label{lemma:main}
Пусть нам дан гамильтонов ориентированный граф. Тогда число возможных движущихся точек, вошедших в первую вершину к моменту времени $T$ можно представить в виде:
$$N_{1}(T) = a_{1}T^{\beta} + b_{1}T^{\beta - 1} + O(T^{\beta - 2})$$, где $a_{1} = \sum_{d \in D_{\beta}}\frac{1}{\beta!\prod_{i = 1}^{\beta}{t(d_{i})}},$
а для общего числа движущихся точек на графе справедлива следующая асимптотическая формула:
        $$N(T) = \left(\sum_{d \in D_{\beta}}\frac{\sum_{e \in E}{t(e)}}{(\beta - 1)!\prod_{i = 1}^{\beta}{t(d_{i})}}\right) \cdot T^{\beta - 1} + O(T^{\beta - 2})$$
    % \end{enumerate}
\end{theorem}
\begin{proof} $ $
 
        1. По теореме \eqref{theorem:N_1} имеем:
        \begin{align*}
            N_{1}(T) &= \sum_{i = 1}^{\beta}{\sum_{d \in D_{i}}{\#\left\{\sum_{j = 1}^{i}{n_{j}t(d_{j}) \leq T, \squad n_{j} \in \mathbb{N}}\right\}}} \\
                     &= {\sum_{d \in D_{\beta}}{\#\left\{\sum_{j = 1}^{\beta}{n_{j}t(d_{j}) \leq T, \squad n_{j} \in \mathbb{N}}\right\}}} + \sum_{i = 1}^{\beta - 1}{\sum_{d \in D_{i}}{\#\left\{\sum_{j = 1}^{i}{n_{j}t(d_{j}) \leq T, \squad n_{j} \in \mathbb{N}}\right\}}} 
                             \end{align*}
            Здесь применяем результат Д.С. Спенсера о многочленах Барнса---Бернулли (см. \cite{RCD}) и лемму \eqref{lemma:linear_independent}. Нужно отметить, что нужное нам представление существует для произвольных линейно независимых над $\mathbb{Q}$ числах. \\

   
        \begin{align*}      &= \sum_{d \in D_{\beta}}{\frac{1}{\beta!\prod_{j = 1}^{\beta}{t(d_{j})}}} T^{\beta} + b'T^{\beta - 1} + O(T^{\beta - 2}) + b''T^{\beta - 1} + O(T^{\beta - 2}) \\
                     &= a_{1}T^{\beta} + b_{1}T^{\beta - 1} + O(T^{\beta - 2}) \\
                      \end{align*}
                      Это то представление, существование которого мы предполагали в 
                      
                      \noindent
                      некоторых предыдущих леммах.

        2. Применяем лемму \eqref{pg} и получаем, что
        \begin{align*}
            N(T) &= \left(\sum_{e \in E}{t(e)}\right) a_{1}  \beta  T^{\beta - 1} + O(T^{\beta - 2}) =\\
             &=\left(\sum_{e \in E}{t(e)}\right) \left(\sum_{d \in D_{\beta}}\frac{1}{\beta!\prod_{i = 1}^{\beta}{t(d_{i})}}\right)  \beta  T^{\beta - 1} + O(T^{\beta - 2})= \\
            &= \left(\sum_{d \in D_{\beta}}\frac{\sum_{e \in E}{t(e)}}{(\beta - 1)!\prod_{i = 1}^{\beta}{t(d_{i})}}\right) \cdot T^{\beta - 1} + O(T^{\beta - 2})
        \end{align*}

    По лемме \eqref{lemma:beta_reachable} можно понимать $D_{\beta}$ как множество всех генерируемых циклов длины $\beta$.
\end{proof}

\section{Обсуждение результатов}
% и компьютерные эксперименты}


\subsection{Случай, когда ровно один полный достижимый набор}

В общем случае в $D_{\beta}$ для гамильтонова графа может быть много наборов достижимых циклов.
Давайте рассмотрим частный случай гамильтоновых графов, для которых есть ровно один полный достижимый набор.

Рассмотрим ориентированный цикл. Разобьем все вершины на два множества. Первое множество будет содержать вершины, номера которых идут подряд, но не будет содержать стартовую вершину. Второе множество будет содержать все остальные вершины (стартовую вершину в частности).

Все ребра, которые находятся вне ориентированного цикла могут идти лишь из второго множества вершин в первое.

%\begin{figure}[!htb]
%\begin{center}
%\includegraphics[scale=0.2]{im-04.jpg}
%\end{center}
%\caption{Пример графа, у которого ровно один полный достижимый набор. Синие вершины из первого множества, красные из второго.}
%\end{figure}

%\begin{figure}[!htb]
%\begin{center}
%\tikzstyle{circ node}=[circle,draw=blue]
%\tikzstyle{arrow style}=[->,-{Latex[width=2mm]}]
%\begin{tikzpicture}[minimum size=1cm, scale=3]
%    \node[circ node][draw=red] (1) at (0 * 36:1cm) {$1$};
%    \node[circ node][draw=red] (2) at (1 * 36:1cm) {$2$};
%    \node[circ node] (3) at (2 * 36:1cm) {$3$};
%    \node[circ node] (4) at (3 * 36:1cm) {$4$};
%    \node[circ node] (5) at (4 * 36:1cm) {$5$};
%    \node[circ node] (6) at (5 * 36:1cm) {$6$};
%    \node[circ node] (7) at (6 * 36:1cm) {$7$};
%    \node[circ node] (8) at (7 * 36:1cm) {$8$};
%    \node[circ node][draw=red] (9) at (8 * 36:1cm) {$9$};
%    \node[circ node][draw=red] (10) at (9 * 36:1cm) {$10$};
%
%    \draw[arrow style] (1) -- (2);
%    \draw[arrow style] (2) -- (3);
%    \draw[arrow style] (3) -- (4);
%    \draw[arrow style] (4) -- (5);
%    \draw[arrow style] (5) -- (6);
%    \draw[arrow style] (6) -- (7);
%    \draw[arrow style] (7) -- (8);
%    \draw[arrow style] (8) -- (9);
%    \draw[arrow style] (9) -- (10);
%    \draw[arrow style] (10) -- (1);
%
%    \draw[arrow style] (2) -- (8);
%    \draw[arrow style] (1) -- (7);
%    \draw[arrow style] (9) -- (3);
%    \draw[arrow style] (9) -- (5);
%\end{tikzpicture}
%\caption{Пример графа, у которого ровно один полный достижимый набор}
%\end{center}
%\end{figure}
%{\color{blue} Синие} вершины из первого множества, {\color{red} красные} из второго.

Имеем ровно один набор полный достижимый набор $d^{0}$, потому что в каждом простом цикле в графе не более одного внешнего ребра.
Итоговая формула:

\begin{gather*}
   N(T) =  \left(\frac{\sum_{e \in E}{t(e)}}{(\beta - 1)!\prod_{i = 1}^{\beta}{t(d^{0}_{i})}}\right) \cdot T^{\beta - 1} + O(T^{\beta - 2})
\end{gather*}

\subsection{Сравнение с ранее полученными результатами} $ $

Давайте теперь рассмотрим класс ориентированных графов,
для которых старший коэффициент асимптотики был получен ранее и сравним результаты. Речь идет про однонаправленные шпернеровы графы, подробное описание которые приведено в \cite{2021}. Основным свойством таких графов было то, что для любой вершины у нас был определен однозначный путь в неё из стартовой вершины, а ребра, задающие циклы, вели только в стартовую вершину.

По лемме $\eqref{pg}$ достаточно найти $N_{1}(T)$. Напомним, что для первого числа Бетти справедлива формула: $\beta = |E| - |V| + 1$. Получаем, что в графе всего $|E| - (|V| - 1) = \beta$ <<обратных>> ребер в стартовую вершину.

Любое время захода в стартовую вершину задается линейной комбинацией с неотрицательными коэффициентами $a_{1}, \ldots, a_{\beta}$ простых циклов $c_{1}, \ldots, c_{\beta}$, каждое из которых содержит обратное ребро.
Заметим, что если $(a_{1}, \ldots, a_{\beta}) \neq (b_{1}, \ldots, b_{\beta})$, $a_{i}, b_{i} \in \mathbb{N} \cup \{0\}$ и $a \neq 0$ или $b \neq 0$, то $\sum_{i = 1}^{\beta}a_{i}t(c_{i}) \neq \sum_{i = 1}^{\beta}b_{i}t(c_{i})$, это верно, потому что в каждом цикле $c_{i}$ есть какое-то обратное ребро $e_{i}$, которого нет в других циклах $c_{j}, \squad j \neq i$, и все ребра линейно независимы над $\mathbb{Q}$.

Имеем

\begin{gather*}
    N_{1}(T) = \#\left\{ \sum_{i = 1}^{\beta}{n_{i}c_{i}} \leq T, \squad n_{i} \in \mathbb{N} \cup \{0\}\right\} = \frac{1}{\beta!\prod_{i = 1}^{\beta}{t(c_{i})}}T^{\beta} + b_{1}T^{\beta - 1} + O(T^{\beta - 2})
\end{gather*}
и первый коэффициент $a_{1} = \frac{1}{\beta!\prod_{i = 1}^{\beta}{t(c_{i})}}$.

Из леммы $\eqref{pg}$ получаем:

\begin{gather*}
    N(T) = \left(\sum_{e \in E}{t(e)}\right)a_{1}\beta T^{\beta - 1} + O(T^{\beta - 2}) = \frac{\sum_{e \in E}{t(e)}}{(\beta - 1)!\prod_{i = 1}^{\beta}{t(c_{i})}}T^{\beta - 1} + O(T^{\beta - 2})
\end{gather*}
{}
Полученная асимптотическая формула для $N(T)$ совпадает с той, что приведена в \cite{2021}.

%\subsection{Компьютерные эксперименты}
%
%В теореме \eqref{lemma:main} мы получили степень и старший коэффициент асимптотического разложения $N(T)$. Чтобы убедиться, что все было сделано верно, проверим формулу на конкретном графе. Возьмем граф с Рис. \ref{fig:graph}.
%
%Добавим времена прохождения ребер графу с Рис. \ref{fig:graph} следующим образом:
%
%
%\begin{figure}[!htb]
%\begin{center}
%\includegraphics[scale=0.1]{im-05.jpg}
%\end{center}
%\caption{Граф с временами}
%\end{figure}
%
%%\begin{figure}[!htb]
%%\begin{center}
%%\tikzstyle{circ node}=[circle,draw=black]
%%\tikzstyle{arrow style}=[->,-{Latex[width=2mm]}]
%%\begin{tikzpicture}[minimum size=1cm, scale=3]
%%    \node[circ node,draw=green] (1) at (0 * 90:1cm) {$1$};
%%    \node[circ node] (2) at (1 * 90:1cm) {$2$};
%%    \node[circ node] (3) at (2 * 90:1cm) {$3$};
%%    \node[circ node] (4) at (3 * 90:1cm) {$4$};
%%
%%    \draw[arrow style] (1) edge node[left] {$\sqrt{3}$} (2);
%%    \draw[arrow style] (2) edge node[right] {$\sqrt{7}$} (3);
%%    \draw[arrow style] (3) edge node[right] {$\sqrt{11}$} (4);
%%    \draw[arrow style] (4) edge node[left] {$\sqrt{19}$} (1);
%%
%%    \draw[arrow style] (4) edge[bend right=30] node[right] {$\sqrt{17}$} (1);
%%    \draw[arrow style] (2) edge[bend left=30] node[right] {$\sqrt{5}$} (1);
%%    \draw[arrow style] (4) edge[bend left=30] node[left] {$\sqrt{13}$} (3);
%%    \draw[arrow style] (1) edge node[auto] {$\sqrt{2}$} (3);
%%\end{tikzpicture}
%%\caption{Граф с временами}
%%\end{center}
%%\end{figure}
%Заметим, что все числа на ребрах --- корни из простых, то есть они линейно независимы над $\mathbb{Q}$.
%Таким образом, из теоремы \eqref{lemma:main} следует, что:
%
%\begin{align*}
%    N(T) &= \left(\sum_{d \in D_{\beta}}\frac{\sum_{e \in E}{t(e)}}{(\beta - 1)!\prod_{i = 1}^{\beta}{t(d_{i})}}\right) \cdot T^{\beta - 1} + O(T^{\beta - 2}) \\
%    \frac{N(T)}{T^{\beta - 1}} &= \sum_{d \in D_{\beta}}\frac{\sum_{e \in E}{t(e)}}{(\beta - 1)!\prod_{i = 1}^{\beta}{t(d_{i})}} + O\left(\frac{1}{T}\right) \\
%\end{align*}
%
%и
%
%\begin{align*}
%    \lim_{T \to +\infty}{\frac{N(T)}{T^{\beta - 1}}} = \sum_{d \in D_{\beta}}\frac{\sum_{e \in E}{t(e)}}{(\beta - 1)!\prod_{i = 1}^{\beta}{t(d_{i})}}
%\end{align*}
%
%
%Проверим, что $\frac{N(T)}{T^{\beta - 1}}$ при достаточно больших значениях $T$ близко к\\
% $\sum_{d \in D_{\beta}}\frac{\sum_{e \in E}{t(e)}}{(\beta - 1)!\prod_{i = 1}^{\beta}{t(d_{i})}}$.
%
%В нашем случае $\sum_{d \in D_{\beta}}\frac{\sum_{e \in E}{t(e)}}{(\beta - 1)!\prod_{i = 1}^{\beta}{t(d_{i})}} \approx 0.000064826299$.
%\begin{figure}[!htb]
%\begin{center}
%\includegraphics[scale=0.3]{Experiment.png}
%\end{center}
%\caption{Сходимость $\frac{N(T)}{T^{\beta - 1}}$}
%\end{figure}
%
%\FloatBarrier
%
%Действительно, $\frac{N(T)}{T^{\beta - 1}}$ приближается к $\sum_{d \in D_{\beta}}\frac{\sum_{e \in E}{t(e)}}{(\beta - 1)!\prod_{i = 1}^{\beta}{t(d_{i})}}$ по мере роста $T$.
%

\section{Заключение}
Мы нашли асимптотику для числа возможных конечных положений случайного блуждания $N(T)$ при $T \to +\infty$ для ориентированных гамильтоновых графов.
Старший коэффициент вычисляется по формуле $\sum_{d \in D_{\beta}}\frac{\sum_{e \in E}{t(e)}}{(\beta - 1)!\prod_{i = 1}^{\beta}{t(d_{i})}}$ и не зависит от выбора порядка на ребрах, то есть $\sum_{d \in D_{\beta}}\frac{1}{\prod_{i = 1}^{\beta}{t(d_{i})}}$ является инвариантом относительно смены порядка на ребрах для гамильтоновых графов. Понимание природы этого инварианта и изучение $N(T)$ для ориентированных сильно связных графов, которые не являются гамильтоновыми, могут быть целью для дальнейшего исследования.

\section{Благодарности}
Д.\,В. Пятько выражает благодарность Д.Э. Волгину за предоставление вычислительных ресурсов для проведения компьютерных экспериментов (результаты которых согласуются с полученными теоретическими выкладками) и Д.А. Полякову за конструктивные обсуждения текста. В.\,Л. Чернышев благодарит А.А. Толченникова за полезные обсуждения.
%Работа выполнена при финансовой поддержке гранта РФФИ 20-07-01103 a.


%=================Список литературы====================
\end{fulltext}
\begin{thebibliography}{99}


\RBibitem{Lovasz}
\by L.~Lovasz
\paper Random walks on graphs: A survey
\jour Combinatorics, Paul Erdos is Eighty
\yr 1993
\pages 1--46

\RBibitem{KB}
\by G.~Berkolaiko, P.~Kuchment
\paper Introduction to Quantum Graphs
\jour Mathematical Surveys and Monographs
\vol 186 AMS
\yr 2014

\RBibitem{RW}
\by V.\,L.~Chernyshev, A.\,A.~Tolchennikov
\paper Polynomial approximation for the number of all possible endpoints of a random walk on a metric graph
\jour Electronic Notes in Discrete Mathematics, Elsevier
\vol 70
\yr 2018
\pages 31–-35

\RBibitem{ChSh}
\by V.\,L.~Chernyshev, A.\,I.~Shafarevich
\paper Statistics of Gaussian packets on metric and decorated graphs
\jour Philosophical transactions of the Royal Society A.
\vol 372
\issue 2007
\yr 2014
%Article number: 20130145,
%DOI: 10.1098/rsta.2013.0145.

\RBibitem{Chernyshev2017}
\by V.\,L.~Chernyshev, A.\,A.~Tolchennikov
\paper Correction to the leading term of asymptotics in the problem of counting the number of points moving on a metric tree
\jour Russian Journal of Mathematical Physics
\vol 24
\issue 3
\yr 2017
\pages 290--298

\RBibitem{RCD}
\by V.\,L.~Chernyshev, A.\,A.~Tolchennikov
\paper The Second Term in the Asymptotics for the Number of Points Moving Along a Metric Graph \jour Regular and Chaotic Dynamics
\vol 22
\issue 8
\yr 2017
\pages 937--948

\RBibitem{2021}
\by V.\,L.~Chernyshev, A.\,A.~Tolchennikov
\paper Asymptotics of the number of endpoints of a random walk on a certain class of directed metric graphs
\yr 2021
%Preprint arXiv:1410.5093


\end{thebibliography}
\end{document}